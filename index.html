<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Harian Bulan Puasa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3a7bd5;
            --secondary-color: #00d2ff;
            --accent-color: #f4f9ff;
            --dark-color: #2d3748;
            --light-color: #f8fafc;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            line-height: 1.6;
            padding: 0;
            margin: 0;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
            padding: 2rem 1rem;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.3;
        }

        header h1 {
            margin-bottom: 0.5rem;
            font-size: 2rem;
        }

        header p {
            margin-bottom: 1rem;
            font-size: 1rem;
            opacity: 0.9;
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .dashboard {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 2rem;
            gap: 1rem;
            justify-content: center;
        }

        .stats-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            flex: 1 1 200px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .stats-card i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .time-section {
            position: relative;
            margin-bottom: 2rem;
            opacity: 0;
            transform: translateY(20px);
            transition: var(--transition);
        }

        .time-section.active {
            opacity: 1;
            transform: translateY(0);
        }

        .time-section.current {
            border-left: 4px solid var(--primary-color);
            padding-left: 1rem;
        }

        .time-section h2 {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .time-section h2:hover {
            background: var(--accent-color);
        }

        .time-section h2 span {
            display: flex;
            align-items: center;
        }

        .time-section h2 i {
            margin-right: 10px;
            color: var(--primary-color);
        }

        .time-section h2 .toggle-icon {
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .activities {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .activities.open {
            max-height: 1000px;
            opacity: 1;
            margin-bottom: 1rem;
        }

        .activities ul {
            list-style: none;
            padding: 1rem;
        }

        .activities li {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            transition: var(--transition);
        }

        .activities li:last-child {
            border-bottom: none;
        }

        .activities li:hover {
            background-color: var(--accent-color);
        }

        .activities strong {
            display: inline-block;
            min-width: 120px;
            color: var(--primary-color);
        }

        .activities .activity-dot {
            height: 10px;
            width: 10px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: inline-block;
            margin-right: 10px;
        }

        .current-time {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .current-time h3 {
            margin-bottom: 0.5rem;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            height: 10px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-bar {
            background: white;
            height: 100%;
            width: 0;
            transition: width 0.5s ease;
        }

        .dark-mode-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
            z-index: 1000;
        }

        .dark-mode-toggle:hover {
            transform: scale(1.1);
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: var(--light-color);
        }

        body.dark-mode .stats-card,
        body.dark-mode .time-section h2,
        body.dark-mode .activities {
            background: #2d3748;
            color: var(--light-color);
        }

        body.dark-mode .time-section h2:hover {
            background: #3a4a5f;
        }

        body.dark-mode .activities li {
            border-bottom: 1px solid #3a4a5f;
        }

        body.dark-mode .activities li:hover {
            background-color: #3a4a5f;
        }

        footer {
            text-align: center;
            padding: 2rem 1rem;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.5rem;
            }
            
            .stats-card {
                flex: 1 1 100%;
            }
            
            .activities strong {
                min-width: 100px;
                font-size: 0.9rem;
            }
            
            .activities li {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .activities strong {
                margin-bottom: 0.5rem;
            }
        }

        /* Animation Classes */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            color: var(--dark-color);
            padding: 1rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            transform: translateX(200%);
            transition: transform 0.5s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        body.dark-mode .notification {
            background: #2d3748;
            color: var(--light-color);
        }

        .sync-button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.5rem 1rem;
            margin-top: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: var(--transition);
        }
        
        .sync-button:hover {
            background: var(--secondary-color);
            transform: scale(1.05);
        }
        
        #sync-status {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--dark-color);
            transition: var(--transition);
        }
        
        #sync-status.connected {
            color: #22c55e;
            font-weight: bold;
        }
        
        body.dark-mode #sync-status.connected {
            color: #4ade80;
        }
        
        #next-activity {
            margin-top: 0.5rem;
            font-weight: bold;
        }
        
        .notification.important {
            background: #f87171;
            color: white;
        }
        
        body.dark-mode .notification.important {
            background: #dc2626;
        }
        
        .add-to-calendar {
            margin-left: 1rem;
            cursor: pointer;
            color: var(--primary-color);
            opacity: 0.7;
            transition: var(--transition);
        }
        
        .add-to-calendar:hover {
            opacity: 1;
            transform: scale(1.2);
        }
        
        .activity-item {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .activity-item.selected {
            background-color: rgba(58, 123, 213, 0.1);
        }
        
        .activity-item.current-activity {
            background-color: rgba(58, G123, 213, 0.2);
            border-left: 3px solid var(--primary-color);
            font-weight: bold;
        }
        
        @keyframes pulse-border {
            0% { border-left-color: var(--primary-color); }
            50% { border-left-color: var(--secondary-color); }
            100% { border-left-color: var(--primary-color); }
        }
        
        .activity-item.current-activity {
            animation: pulse-border 2s infinite;
        }
    </style>
</head>
<body>

    <header>
        <h1>Jadwal Harian Selama Bulan Puasa</h1>
        <p>Jadwal ini mencakup belajar, bermain, dan aktivitas lainnya.</p>
    </header>

    <main>
        <div class="current-time">
            <h3>Waktu Saat Ini</h3>
            <div id="current-time">00:00:00</div>
            <div id="current-activity">Sedang tidak ada aktivitas terjadwal</div>
            <div class="progress-container">
                <div class="progress-bar" id="activity-progress"></div>
            </div>
        </div>
        
        <div id="next-activity">Memuat aktivitas berikutnya...</div>
<button id="sync-calendar" class="sync-button">
    <i class="fas fa-sync"></i> Sinkronkan dengan Kalender
</button>
<div id="sync-status">Menghubungkan ke perangkat...</div>

        <div class="dashboard">
            <div class="stats-card">
                <i class="fas fa-chess"></i>
                <h3>Jam Bermain</h3>
                <p>5.5 jam/hari</p>
            </div>
            <div class="stats-card">
                <i class="fas fa-book"></i>
                <h3>Waktu Belajar</h3>
                <p>2 jam/hari</p>
            </div>
            <div class="stats-card">
                <i class="fas fa-walking"></i>
                <h3>Waktu Berjalan-jalan</h3>
                <p>1 jam/hari</p>
            </div>
            <div class="stats-card">
                <i class="fas fa-bed"></i>
                <h3>Waktu Tidur</h3>
                <p>6 jam/hari</p>
            </div>
        </div>

        <section class="time-section" id="section-subuh">
            <h2>
                <span><i class="fas fa-moon"></i> Sebelum Subuh</span>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </h2>
            <div class="activities">
                <ul>
                    <li><span class="activity-dot"></span><strong>03:30 – 04:15</strong> | Sahur (Makan bergizi & Minum cukup air)</li>
                    <li><span class="activity-dot"></span><strong>04:15 – 04:30</strong> | Salat Subuh</li>
                    <li><span class="activity-dot"></span><strong>04:30 – 06:00</strong> | Tidur Tambahan</li>
                </ul>
            </div>
        </section>

        <section class="time-section" id="section-pagi">
            <h2>
                <span><i class="fas fa-sun"></i> Pagi</span>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </h2>
            <div class="activities">
                <ul>
                    <li><span class="activity-dot"></span><strong>06:00 – 07:00</strong> | Bangun & Mandi</li>
                    <li><span class="activity-dot"></span><strong>07:00 – 09:00</strong> | Belajar Pembukaan Catur</li>
                    <li><span class="activity-dot"></span><strong>09:00 – 10:00</strong> | Istirahat</li>
                    <li><span class="activity-dot"></span><strong>10:00 – 12:00</strong> | Bermain Catur</li>
                    <li><span class="activity-dot"></span><strong>12:00 – 12:30</strong> | Salat Dzuhur & Istirahat</li>
                </ul>
            </div>
        </section>

        <section class="time-section" id="section-siang">
            <h2>
                <span><i class="fas fa-cloud-sun"></i> Siang</span>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </h2>
            <div class="activities">
                <ul>
                    <li><span class="activity-dot"></span><strong>12:30 – 14:00</strong> | Tidur Siang (90 menit)</li>
                    <li><span class="activity-dot"></span><strong>14:00 – 15:30</strong> | Bermain Catur</li>
                    <li><span class="activity-dot"></span><strong>15:30 – 16:30</strong> | Mandi, Salat Ashar & Istirahat</li>
                    <li><span class="activity-dot"></span><strong>16:30 – 17:30</strong> | Ngabuburit & Persiapan Berbuka</li>
                </ul>
            </div>
        </section>

        <section class="time-section" id="section-malam">
            <h2>
                <span><i class="fas fa-moon"></i> Malam</span>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </h2>
            <div class="activities">
                <ul>
                    <li><span class="activity-dot"></span><strong>17:30 – 18:00</strong> | Berbuka Puasa & Salat Maghrib</li>
                    <li><span class="activity-dot"></span><strong>18:00 – 19:30</strong> | Waktu Istirahat</li>
                    <li><span class="activity-dot"></span><strong>19:30 – 20:00</strong> | Salat Isya & Tarawih</li>
                    <li><span class="activity-dot"></span><strong>20:00 – 21:00</strong> | Belajar Pembukaan Catur</li>
                    <li><span class="activity-dot"></span><strong>21:00 – 22:00</strong> | Bermain Catur</li>
                    <li><span class="activity-dot"></span><strong>22:00 – 24:00</strong> | Istirahat</li>
                    <li><span class="activity-dot"></span><strong>24:00 – 03:30</strong> | Tidur Malam</li>
                </ul>
            </div>
        </section>
    </main>

    <div class="notification" id="notification">
        <p>Notifikasi akan muncul di sini</p>
    </div>

    <button class="dark-mode-toggle" id="dark-mode-toggle">
        <i class="fas fa-moon"></i>
    </button>

    <footer>
        <p>&copy; 2024 Jadwal Bulan Puasa | Dibuat oleh Shinji</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
    const sections = document.querySelectorAll('.time-section');
    sections.forEach(section => {
        const heading = section.querySelector('h2');
        const activities = section.querySelector('.activities');
        const toggleIcon = section.querySelector('.toggle-icon');
        
        heading.addEventListener('click', () => {
            activities.classList.toggle('open');
            toggleIcon.classList.toggle('fa-chevron-up');
            toggleIcon.classList.toggle('fa-chevron-down');
        });
        
        setTimeout(() => {
            section.classList.add('active');
        }, 100 * Array.prototype.indexOf.call(sections, section));
    });
    
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const body = document.body;
    const icon = darkModeToggle.querySelector('i');
    
    darkModeToggle.addEventListener('click', () => {
        body.classList.toggle('dark-mode');
        icon.classList.toggle('fa-moon');
        icon.classList.toggle('fa-sun');
        
        localStorage.setItem('darkMode', body.classList.contains('dark-mode'));
    });
    
    if (localStorage.getItem('darkMode') === 'true') {
        body.classList.add('dark-mode');
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
    }
    
    const activities = [
        { name: "Sahur", start: "03:30", end: "04:15", section: "subuh", important: true },
        { name: "Salat Subuh", start: "04:15", end: "04:30", section: "subuh", important: true },
        { name: "Tidur Tambahan", start: "04:30", end: "06:00", section: "subuh" },
        { name: "Bangun & Mandi", start: "06:00", end: "07:00", section: "pagi", important: true },
        { name: "Belajar Pembukaan Catur", start: "07:00", end: "09:00", section: "pagi" },
        { name: "Istirahat", start: "09:00", end: "10.00", section: "pagi" },
        { name: "Bermain Catur", start: "10.00", end: "12:00", section: "pagi" },
        { name: "Salat Dzuhur & Istirahat", start: "12:00", end: "12:30", section: "pagi", important: true },
        { name: "Tidur Siang", start: "12:30", end: "14:00", section: "siang" },
        { name: "Bermain Catur", start: "14:00", end: "15:30", section: "siang" },
        { name: "Mandi, Salat Ashar & Istirahat", start: "15:30", end: "16:30", section: "siang" },
        { name: "Ngabuburit & Persiapan Berbuka", start: "16.30", end: "17:30", section: "siang", important: true },
        { name: "Berbuka Puasa & Salat Maghrib", start: "17:30", end: "18:00", section: "malam", important: true },
        { name: "Waktu Istirahat", start: "18:00", end: "19:30", section: "malam" },
        { name: "Salat Isya & Tarawih", start: "19:30", end: "20:00", section: "malam", important: true },
        { name: "Belajar Pembukaan Catur", start: "20:00", end: "21:00", section: "malam" },
        { name: "Bermain Catur", start: "21:00", end: "22:00", section: "malam" },
        { name: "Istirahat", start: "22:00", end: "24:00", section: "malam" },
        { name: "Tidur Malam", start: "24:00", end: "03:30", section: "malam", overnight: true, important: true }
    ];
    
    function updateCurrentTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('id-ID');
        document.getElementById('current-time').textContent = timeString;
        
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        const currentTimeInMinutes = currentHour * 60 + currentMinute;
        
        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }
        
        let currentActivity = null;
        let activityProgress = 0;
        let nextActivity = null;
        let timeToNextActivity = Infinity;
        
        activities.forEach(activity => {
            const startTime = timeToMinutes(activity.start);
            let endTime = timeToMinutes(activity.end);
            
            if (activity.overnight && endTime < startTime) {
                if (currentTimeInMinutes >= startTime || currentTimeInMinutes < endTime) {
                    currentActivity = activity;
                    
                    if (currentTimeInMinutes >= startTime) {
                        activityProgress = ((currentTimeInMinutes - startTime) / (24 * 60 - startTime + endTime)) * 100;
                    } else {
                        activityProgress = ((currentTimeInMinutes + 24 * 60 - startTime) / (24 * 60 - startTime + endTime)) * 100;
                    }
                }
            } else if (currentTimeInMinutes >= startTime && currentTimeInMinutes < endTime) {
                currentActivity = activity;
                activityProgress = ((currentTimeInMinutes - startTime) / (endTime - startTime)) * 100;
            }
            
            if (startTime > currentTimeInMinutes) {
                const timeUntilStart = startTime - currentTimeInMinutes;
                if (timeUntilStart < timeToNextActivity) {
                    timeToNextActivity = timeUntilStart;
                    nextActivity = activity;
                }
            } else if (activity.overnight && startTime < currentTimeInMinutes) {
                const timeUntilStart = (24 * 60 - currentTimeInMinutes) + startTime;
                if (timeUntilStart < timeToNextActivity) {
                    timeToNextActivity = timeUntilStart;
                    nextActivity = activity;
                }
            }
        });
        
        if (currentActivity) {
            document.getElementById('current-activity').textContent = `Aktivitas Sekarang: ${currentActivity.name}`;
            document.getElementById('activity-progress').style.width = `${activityProgress}%`;
            
            // Highlight current section
            sections.forEach(section => section.classList.remove('current'));
            document.getElementById(`section-${currentActivity.section}`).classList.add('current');
            
            const currentSection = document.getElementById(`section-${currentActivity.section}`);
            const activitiesElement = currentSection.querySelector('.activities');
            const toggleIcon = currentSection.querySelector('.toggle-icon');
            
            if (!activitiesElement.classList.contains('open')) {
                activitiesElement.classList.add('open');
                toggleIcon.classList.remove('fa-chevron-down');
                toggleIcon.classList.add('fa-chevron-up');
            }
            
          document.querySelectorAll('.activities li').forEach(li => {
              li.classList.remove('current-activity');
              if (li.textContent.includes(currentActivity.name)) {
                  li.classList.add('current-activity');
              }
          });
        } else {
            document.getElementById('current-activity').textContent = 'Sedang tidak ada aktivitas terjadwal';
            document.getElementById('activity-progress').style.width = '0%';
        }
        
        if (nextActivity) {
            const hours = Math.floor(timeToNextActivity / 60);
            const minutes = timeToNextActivity % 60;
            let timeDisplay = '';
            
            if (hours > 0) {
                timeDisplay += `${hours} jam `;
            }
            if (minutes > 0 || hours === 0) {
                timeDisplay += `${minutes} menit`;
            }
            
            document.getElementById('next-activity').textContent = `Aktivitas Berikutnya: ${nextActivity.name} (dalam ${timeDisplay})`;
        }
        
        activities.forEach(activity => {
            const startTime = timeToMinutes(activity.start);
            let notificationTime = 5;
            
            if (activity.important) {
                notificationTime = 15;
            }
            
            const timeToStart = startTime - currentTimeInMinutes;
            if (timeToStart > 0 && timeToStart <= notificationTime && timeToStart % notificationTime === 0) {
                showNotification(`Aktivitas "${activity.name}" akan dimulai dalam ${timeToStart} menit`, activity.important);
                
                if (Notification.permission === "granted") {
                    const notification = new Notification(`Jadwal Puasa - ${activity.name}`, {
                        body: `Aktivitas akan dimulai dalam ${timeToStart} menit`,
                        icon: 'https://cdn-icons-png.flaticon.com/512/2693/2693507.png' // Default icon
                    });
                    
                    notification.onclick = function() {
                        window.focus();
                        this.close();
                    };
                }
            }
        });
    }
    
    setInterval(updateCurrentTime, 1000);
    
    // Initial call
    updateCurrentTime();
    
    if ('Notification' in window) {
        Notification.requestPermission();
    }
    
    function showNotification(message, important = false) {
        const notification = document.getElementById('notification');
        notification.querySelector('p').textContent = message;
        notification.classList.add('show');
        
        if (important) {
            notification.classList.add('important');
            if ('Audio' in window) {
                const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-alert-quick-chime-766.mp3');
                audio.play().catch(e => console.log('Audio play failed: ', e));
            }
        } else {
            notification.classList.remove('important');
        }
        
        setTimeout(() => {
            notification.classList.remove('show');
            notification.classList.remove('important');
        }, 5000);
    }
    
    const addToCalendarButtons = document.querySelectorAll('.add-to-calendar');
    addToCalendarButtons.forEach(button => {
        button.addEventListener('click', (e) => {
            e.stopPropagation();
            
            const activityText = button.parentElement.textContent;
            const activityName = activityText.split('|')[1].trim();
            const timeRange = activityText.split('|')[0].trim();
            const [startTime, endTime] = timeRange.split('–').map(t => t.trim());
            
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            const startDateTime = `${dateStr}T${startTime.replace(':', '')}00`;
            const endDateTime = `${dateStr}T${endTime.replace(':', '')}00`;
            
            const calendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(activityName)}&dates=${startDateTime}/${endDateTime}&details=${encodeURIComponent('Jadwal Puasa')}&sf=true&output=xml`;
            
            window.open(calendarUrl, '_blank');
        });
    });
    
    const activityItems = document.querySelectorAll('.activities li');
    activityItems.forEach((item, index) => {
        item.classList.add('activity-item');
        
        const calendarButton = document.createElement('span');
        calendarButton.className = 'add-to-calendar';
        calendarButton.innerHTML = '<i class="fas fa-calendar-plus"></i>';
        item.appendChild(calendarButton);
        
        item.addEventListener('click', () => {
            const activityName = item.textContent.split('|')[1].trim();
            showNotification(`Aktivitas dipilih: ${activityName}`);
            
            // Toggle selected class
            item.classList.toggle('selected');
            
            const selectedActivities = JSON.parse(localStorage.getItem('selectedActivities') || '[]');
            if (item.classList.contains('selected')) {
                if (!selectedActivities.includes(index)) {
                    selectedActivities.push(index);
                }
            } else {
                const activityIndex = selectedActivities.indexOf(index);
                if (activityIndex > -1) {
                    selectedActivities.splice(activityIndex, 1);
                }
            }
            localStorage.setItem('selectedActivities', JSON.stringify(selectedActivities));
        });
    });
    
    const savedActivities = JSON.parse(localStorage.getItem('selectedActivities') || '[]');
    savedActivities.forEach(index => {
        if (activityItems[index]) {
            activityItems[index].classList.add('selected');
        }
    });
    
    if ('showOpenFilePicker' in window) {
        document.getElementById('sync-calendar').addEventListener('click', async () => {
            try {
                const fileHandles = await window.showOpenFilePicker({
                    types: [
                        {
                            description: 'Calendar Files',
                            accept: {
                                'text/calendar': ['.ics'],
                            },
                        },
                    ],
                    multiple: false,
                });
                
                if (fileHandles.length > 0) {
                    const fileData = await fileHandles[0].getFile();
                    const text = await fileData.text();
                    
                    showNotification('Kalender berhasil disinkronkan!');
                }
            } catch (error) {
                console.error('Error syncing calendar:', error);
                showNotification('Gagal menyinkronkan kalender');
            }
        });
    }
    
    let touchStartX = 0;
    let touchEndX = 0;
    
    document.addEventListener('touchstart', e => {
        touchStartX = e.changedTouches[0].screenX;
    });
    
    document.addEventListener('touchend', e => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    });
    
    function handleSwipe() {
        const minSwipeDistance = 50;
        
        if (touchEndX - touchStartX > minSwipeDistance) {
            sections.forEach(section => {
                const activities = section.querySelector('.activities');
                const toggleIcon = section.querySelector('.toggle-icon');
                
                activities.classList.remove('open');
                toggleIcon.classList.remove('fa-chevron-up');
                toggleIcon.classList.add('fa-chevron-down');
            });
        } else if (touchStartX - touchEndX > minSwipeDistance) {
            sections.forEach(section => {
                const activities = section.querySelector('.activities');
                const toggleIcon = section.querySelector('.toggle-icon');
                
                activities.classList.add('open');
                toggleIcon.classList.add('fa-chevron-up');
                toggleIcon.classList.remove('fa-chevron-down');
            });
        }
    }
    
    setTimeout(() => {
        document.getElementById('sync-status').textContent = 'Terhubung ke Perangkat';
        document.getElementById('sync-status').classList.add('connected');
    }, 2000);
});
</script>